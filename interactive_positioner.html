<!DOCTYPE html>
<html>
<head>
    <title>Interactive Endorsement Positioner</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        #pdfViewer {
            position: relative;
            border: 3px solid #333;
            margin: 20px 0;
            background: white;
            overflow: hidden;
        }
        #endorsementBox {
            position: absolute;
            background: yellow;
            border: 3px solid red;
            cursor: move;
            padding: 8px;
            font-size: 11px;
            font-weight: bold;
            line-height: 1.3;
            color: black;
            width: 140px;
            height: 80px;
            z-index: 1000;
            user-select: none;
            box-sizing: border-box;
            left: 400px;
            top: 200px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.success:hover { background: #1e7e34; }
        .info-panel {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .coordinates {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            margin: 5px 0;
        }
        input[type="file"] {
            margin: 10px 0;
            padding: 5px;
        }
        .dragging {
            opacity: 0.8;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>üéØ Interactive Endorsement Positioner</h2>
        <p><strong>Instructions:</strong> Load your PDF, then drag the yellow endorsement box to exactly where you want it positioned!</p>
        
        <div class="controls">
            <input type="file" id="pdfFile" accept=".pdf" />
            <button onclick="resetPosition()">Reset Position</button>
            <button onclick="copyCoordinates()" class="success">Copy Coordinates</button>
        </div>

        <div id="pdfViewer">
            <div id="endorsementBox">
                UCC ART. 3<br>
                ENDORSEMENT<br>
                ACCEPTED FOR VALUE<br>
                EXEMPT FROM LEVY<br>
                DISCHARGED<br>
                BY: CREDITOR<br>
                W/O RECOURSE
            </div>
        </div>

        <div class="info-panel">
            <h3>üìç Position Information</h3>
            <div class="coordinates" id="coordDisplay">
                Load PDF and position the endorsement box
            </div>
            <p><strong>Usage:</strong> Copy the coordinates above and tell me the box_x and box_y values to update the code!</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
        let pdfDoc = null;
        let scale = 1;
        let pdfWidth = 0, pdfHeight = 0;

        const pdfViewer = document.getElementById('pdfViewer');
        const endorsementBox = document.getElementById('endorsementBox');
        const coordDisplay = document.getElementById('coordDisplay');

        // File input handler
        document.getElementById('pdfFile').addEventListener('change', loadPDF);

        // Simplified drag functionality
        let dragData = { isDragging: false, startX: 0, startY: 0, startLeft: 0, startTop: 0 };

        endorsementBox.addEventListener('mousedown', function(e) {
            dragData.isDragging = true;
            dragData.startX = e.clientX;
            dragData.startY = e.clientY;
            dragData.startLeft = parseInt(endorsementBox.style.left) || 0;
            dragData.startTop = parseInt(endorsementBox.style.top) || 0;
            endorsementBox.style.cursor = 'grabbing';
            e.preventDefault();
        });

        document.addEventListener('mousemove', function(e) {
            if (!dragData.isDragging) return;
            
            const deltaX = e.clientX - dragData.startX;
            const deltaY = e.clientY - dragData.startY;
            
            let newLeft = dragData.startLeft + deltaX;
            let newTop = dragData.startTop + deltaY;
            
            // Keep within bounds
            const maxLeft = pdfViewer.clientWidth - endorsementBox.offsetWidth;
            const maxTop = pdfViewer.clientHeight - endorsementBox.offsetHeight;
            
            newLeft = Math.max(0, Math.min(newLeft, maxLeft));
            newTop = Math.max(0, Math.min(newTop, maxTop));
            
            endorsementBox.style.left = newLeft + 'px';
            endorsementBox.style.top = newTop + 'px';
            
            updateCoordinates();
            e.preventDefault();
        });

        document.addEventListener('mouseup', function(e) {
            if (dragData.isDragging) {
                dragData.isDragging = false;
                endorsementBox.style.cursor = 'move';
            }
        });

        async function loadPDF(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const arrayBuffer = await file.arrayBuffer();
                pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
                
                const page = await pdfDoc.getPage(1);
                const viewport = page.getViewport({ scale: 1 });
                
                // Set up canvas for PDF rendering
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Calculate scale to fit container
                const maxWidth = 800;
                scale = Math.min(maxWidth / viewport.width, 1);
                const scaledViewport = page.getViewport({ scale });
                
                canvas.width = scaledViewport.width;
                canvas.height = scaledViewport.height;
                
                pdfWidth = viewport.width;
                pdfHeight = viewport.height;
                
                // Style the PDF viewer
                pdfViewer.style.width = canvas.width + 'px';
                pdfViewer.style.height = canvas.height + 'px';
                
                // Clear and add canvas
                const existingCanvas = pdfViewer.querySelector('canvas');
                if (existingCanvas) existingCanvas.remove();
                
                pdfViewer.appendChild(canvas);
                
                // Render PDF
                const renderContext = {
                    canvasContext: ctx,
                    viewport: scaledViewport
                };
                
                await page.render(renderContext).promise;
                
                // Reset endorsement box position
                resetPosition();
                updateCoordinates();
                
            } catch (error) {
                alert('Error loading PDF: ' + error.message);
            }
        }



        function resetPosition() {
            endorsementBox.style.left = '400px';
            endorsementBox.style.top = '200px';
            updateCoordinates();
        }

        function updateCoordinates() {
            if (!pdfDoc) return;
            
            const boxLeft = parseInt(endorsementBox.style.left || '0');
            const boxTop = parseInt(endorsementBox.style.top || '0');
            
            // Convert screen coordinates to PDF coordinates
            const pdfX = Math.round(boxLeft / scale);
            const pdfY = Math.round(pdfHeight - (boxTop / scale)); // PDF Y is bottom-up
            
            coordDisplay.innerHTML = `
                <strong>Screen Position:</strong> x=${boxLeft}px, y=${boxTop}px<br>
                <strong>PDF Coordinates:</strong> x=${pdfX}, y=${pdfY}<br>
                <strong>For Code:</strong> box_x = ${pdfX}, box_y = ${pdfY}<br>
                <strong>PDF Dimensions:</strong> ${pdfWidth} √ó ${pdfHeight} points
            `;
        }

        function copyCoordinates() {
            const boxLeft = parseInt(endorsementBox.style.left || '0');
            const boxTop = parseInt(endorsementBox.style.top || '0');
            const pdfX = Math.round(boxLeft / scale);
            const pdfY = Math.round(pdfHeight - (boxTop / scale));
            
            const text = `box_x = ${pdfX}, box_y = ${pdfY}`;
            navigator.clipboard.writeText(text).then(() => {
                alert('Coordinates copied to clipboard!');
            });
        }

        // Initialize
        resetPosition();
    </script>
</body>
</html>